---
title: "KidDraw-Analysis1"
author: "Bria Long"
date: "11/24/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages(c("dplyr","langcog","tidyr","ggplot2","lme4"))

```

## Load data and do basic preprocessing.
```{r}
# Source some helper functions
source("/Users/brialong/Documents/GitHub/kiddraw/analysis/museumdraw/helper_code/useful.R")

## Read in data outputs from python - stroke numbers, intensity, bounding boc, etc.
d <- read.csv("preprocessed_data/museumdraw_E1c_imageData.csv");

# get rid of drwaings without age - these were when we were testing the interface.
d <- d %>%
  filter(!is.na(age))

# make new variable name with image name for joining with recognition data
d$imNameShort = paste(d$category, '_sketch','_', d$age,'_', d$session_id,'.png', sep="");        
## Read in data outputs from turk data - true/false recognition with 21AFC
r <- read.csv("preprocessed_data/museumdraw_E1c_recognitionData.csv");

## check we have the right lengths
length(d$session_id)==length(unique(r$imageName));
```
## Take a look at the raw rating data as a sanity check
Confusions look more or less reasonable
```{r}
dataFrameR=as.data.frame(r);

ratingConfusions <- dataFrameR %>%
  dplyr::group_by(category, rating)  %>%
  dplyr::summarize(number = n())

ggplot(ratingConfusions, aes(rating,number))+
  geom_point() +
  facet_wrap(~category) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

##  Preprocess data and join datasets
```{r}
# add special column 
r$cantTell=(r$rating=="cannott tell at all")

## Get the percent recognized for each drawing
corbyItem <- r %>%
  dplyr::group_by(imNameShort) %>%
  dplyr::summarize(meanCorrect = mean(correct), propCantTell = mean(cantTell))

## Joint the two datasets together
joint=join(d,corbyItem);
```

## How much do these descripive variables covary with eachother?
In all of the following plots, one point = one drawing
```{r, echo=FALSE}
ggplot(d, aes(num_strokes, mean_intensity)) +
  geom_point()

ggplot(d, aes(num_strokes, draw_duration)) +
  geom_point()
```

## Are darker drawings better recognized?
# Interesting - probably somewhat up to a point. Last points are creating a big tail on the loess function but probably more ink = more information = better recognized
```{r, echo=FALSE}
ggplot(joint, aes(mean_intensity, meanCorrect)) + 
  geom_jitter(alpha=.5) +
  geom_smooth(method="loess",span=1)
```

## Are drawings with more strokes better recognized?
# Nope,probalby not
```{r, echo=FALSE}
ggplot(joint, aes(num_strokes, meanCorrect)) +
  geom_jitter(alpha=.5) +
  geom_smooth(method="loess",span=1)

```

## Are drawings that take longer better recognized?
# Probably nothing here
```{r, echo=FALSE}
ggplot(joint, aes(draw_duration, meanCorrect)) +
  geom_jitter(alpha=.5) +
  geom_smooth(method="loess",span=1)
```

## Are drawings better recognized with age?
# Interesting potential plateau by ~6?
```{r, echo=FALSE}
ggplot(joint, aes(age, meanCorrect)) +
  geom_jitter(alpha=.5) +
  geom_smooth(method="loess",span=1) 
```

## How does this variance break down by catergory?
# Some items show a stronger trend than others but overall looks good
```{r, echo=FALSE}
ggplot(joint, aes(age, meanCorrect)) +
  geom_jitter(alpha=.5) +
  geom_smooth(method="loess",span=1) + 
  facet_wrap(~category)
```

## How much variance is there per participant (i.e., per child drawer?)
Looks like there are some kids that are very bad or very good at drawing, but there is also a fair number of kids with wide distributions

```{r, echo=FALSE}
ggplot(joint, aes(1, meanCorrect)) +
  geom_violin() +
  facet_wrap(~session_id)
```

## Basic descriptives in data
``` {r}
# Number of drawings
length(joint$imNameShort)

# Number of drawers
length(unique(joint$session_id))

# Average age of drawers
round(mean(joint$age),2)

# Drawings by age category
countDrawings=aggregate(imNameShort ~ age, joint, length)
round(countDrawings,2)


ageDescriptives <- joint %>%
  dplyr::group_by(age) %>%
  dplyr::summarize(meanCorrect = mean(meanCorrect), propCantTell = mean(propCantTell))

# Percent correct by age category
ageCorrOut=round(ageDescriptives$meanCorrect*100,1)

# Percent "can't tell at all" by age category
round(ageDescriptives$propCantTell*100,1)

```

## Inferential statistics - linear mixed models

# Check out main DV and transform it
```{r}
# ggplot(joint, aes(meanCorrect)) +
#   geom_histogram()

# normalize by arc sine transformation - constant
# http://www2.psychology.uiowa.edu/faculty/mordkoff/GradStats/part%201/I.08%20transforms.pdf
normalizedPropData <- function (data) {
  out = (asin(sqrt(data)) - 0.2854)
}

joint$normCorrect=normalizedPropData(joint$meanCorrect)

# # replot it - doesn't look perfect but better
# ggplot(joint, aes(normCorrect)) +
#   geom_histogram(bins =15)
  
```
## Does recogizability of drawings increase with age? 
# Full random effects structure with extra fixed effects for number of strokes, draw duration, and avg intensity (e.g., amount of ink)
``` {r}
fullModel=lmer(normCorrect ~ age + category + mean_intensity + num_strokes + draw_duration + (1|session_id) + (1|category), joint, REML = FALSE)

# Full model minus age
noAge=lmer(normCorrect ~ category + mean_intensity + num_strokes + draw_duration + (1 | session_id) + (1|category), joint, REML = FALSE)

# Model testing - model that includes age is better than model without age.
modelOut=anova(fullModel,noAge)
pOut=format.pval(modelOut$`Pr(>Chisq)`[2],1); # these quotes make it hard to embed in text...shorter variable for ease
```

VSS ABSTRACT DRAFT

In order to draw a “chair”, we need both to access a mental representation of this category and distill this representation into a the few strokes of a pen. These visual abstractions capture ‘high-level’ perceptual similarity relationships between object categories (Fan, Yamins, & Turk-Brown, 2015), depicting the key perceptual features needed to convey category membership.  Here, we examine when children develop the ability to quickly produce these abstract visual representations. Children (N = `r length(unique(joint$session_id))`, M = `r round(mean(joint$age),2)` years, range 4-10 years) participated in a drawing game on an iPad where they were prompted to draw one of sixteen object categories with a verbal cue (e.g., “Can you draw a cup?”).  Children drew each object category for 30 seconds, after which they were prompted to either make another drawing or to stop drawing altogether. Afterwards, a group of adults (N = 15) were shown all 286 drawings and attempted to recognize each drawing by choosing between the original 16 object categories and 6 additional foil categories. We asked whether the recognizability of drawings increased with age by fitting linear mixed-effect models. We found that this was the case, despite a wide degree of variation across  object categories and by individual children, and when accounting for the amount of time spent drawing, number of strokes, and ink used (% drawings recognized; chance = 4.8%; $M_{4yrs}$ = `r ageCorrOut[1]`%, $M_{5yrs}$ = `r ageCorrOut[2]`%, $M_{6yrs}$ = `r ageCorrOut[3]`%, $M_{7yrs}$ = `r ageCorrOut[4]`%,$M_{8yrs}$ = `r ageCorrOut[5]`%, $M_{9yrs}$ = `r ageCorrOut[6]`%, $M_{10yrs}$ = `r ageCorrOut[7]`%); removing age from the model significantly decreased the fit ($X^2$(1) = `r round(modelOut$Chisq[2],2)`, p = `r pOut`).These results suggest that by middle childhood we develop the ability to quickly produce visual abstractions that efficiently convey object category information, and broadly point towards visual production as a new avenue for examining the development of object category representations.


